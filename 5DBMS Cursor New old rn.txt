Assignment 1 â€“ Merge N_Roll_Call into O_Roll_Call Using Parameterized Cursor

CREATE DATABASE IF NOT EXISTS studentDB;
USE studentDB;

-- Existing Roll Call Table
CREATE TABLE O_Roll_Call (
    roll_no INT PRIMARY KEY,
    student_name VARCHAR(50),
    marks INT
);

-- New Roll Call Table
CREATE TABLE N_Roll_Call (
    roll_no INT,
    student_name VARCHAR(50),
    marks INT
);
----------------------------------------------------------------
INSERT INTO O_Roll_Call VALUES 
(1, 'Amit', 85),
(2, 'Sneha', 92),
(3, 'Rahul', 78);

INSERT INTO N_Roll_Call VALUES 
(3, 'Rahul', 78),
(4, 'Priya', 88);
-----------------------------------------------------------------------
DELIMITER //

CREATE PROCEDURE MergeRollCall()
BEGIN
    DECLARE done INT DEFAULT 0;
    DECLARE v_roll INT;
    DECLARE v_name VARCHAR(50);
    DECLARE v_marks INT;

    -- Parameterized cursor
    DECLARE cur_students CURSOR FOR
        SELECT roll_no, student_name, marks FROM N_Roll_Call;

    DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = 1;

    OPEN cur_students;

    read_loop: LOOP
        FETCH cur_students INTO v_roll, v_name, v_marks;
        IF done THEN
            LEAVE read_loop;
        END IF;

        -- Insert only if roll_no does not exist
        IF NOT EXISTS (SELECT 1 FROM O_Roll_Call WHERE roll_no = v_roll) THEN
            INSERT INTO O_Roll_Call (roll_no, student_name, marks)
            VALUES(v_roll, v_name, v_marks);
        END IF;
    END LOOP;

    CLOSE cur_students;

    -- Show final table
    SELECT * FROM O_Roll_Call ORDER BY roll_no;
END //

DELIMITER ;
-------------------------------------------------------------------
CALL MergeRollCall();




